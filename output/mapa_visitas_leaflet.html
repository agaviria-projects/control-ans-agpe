
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mapa Visitas AGPE</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
html,body{margin:0;padding:0;height:100%;overflow:hidden;}
#map{height:100vh;width:100%;}

.panelFiltros{
  position:absolute;
  top:70px;
  right:15px;
  background:#ffffff;
  padding:18px;
  width:270px;
  border-radius:16px;
  box-shadow:0 8px 26px rgba(0,0,0,.25);
  font-family:Segoe UI, Arial;
  z-index:9999;
}

.panelFiltros h3{margin:0 0 12px;font-size:16px;color:#1E8449;}
.lbl{display:block;margin-top:8px;font-size:12px;font-weight:600;color:#2C3E50;}

.panelFiltros select,
.inputPedido{
  width:100%;
  padding:8px;
  margin:6px 0 12px;
  border-radius:8px;
  border:1px solid #ccc;
}

.btnRow{display:flex;gap:6px;}
button{padding:8px;border:none;border-radius:8px;cursor:pointer;font-size:12px;}
.btnFiltrar{background:#3498DB;color:white;}
.btnLimpiar{background:#7F8C8D;color:white;}
.btnCopiar{background:#2ECC71;color:white;width:100%;margin-top:8px;}

#toast{
  position:fixed;
  bottom:30px;
  left:50%;
  transform:translateX(-50%);
  background:#1E8449;
  color:white;
  padding:14px 22px;
  border-radius:12px;
  font-size:13px;
  display:none;
  z-index:99999;
}
</style>
</head>

<body>

<div id="map"></div>

<div class="panelFiltros">
  <h3>Filtros AGPE</h3>

  <label class="lbl">Pedido</label>
  <input type="text" id="fPedido" class="inputPedido" placeholder="Ej: 23560158">

  <label class="lbl">Observaci√≥n</label>
  <select id="fObs"></select>

  <label class="lbl">Tipo Visita</label>
  <select id="fTipo">
    <option value="">-- Todas --</option>
  </select>

  <div class="btnRow">
    <button class="btnFiltrar" onclick="aplicarFiltros()">Filtrar</button>
    <button class="btnLimpiar" onclick="limpiarFiltros()">Limpiar</button>
  </div>

  <button class="btnCopiar" onclick="copiarEnlace()">Copiar enlace</button>
</div>

<div id="toast">Datos copiados. Listo para enviar por WhatsApp</div>

<script>
// ======================= MAPA =======================
var map = L.map('map').setView([6.2443,-75.581],12);

var mapaNormal = L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  {
    maxZoom: 18,
    maxNativeZoom: 18
  }
).addTo(map);

var mapaSatelital = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  {
    maxZoom: 19
  }
);

L.control.layers(
  {"Mapa est√°ndar": mapaNormal, "Satelital": mapaSatelital},
  null,
  {position:'topright'}
).addTo(map);

// ======================= ICONOS =======================
var iconAzul = L.icon({
  iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
  iconSize:[25,41],iconAnchor:[12,41]
});

var iconNaranja = L.icon({
  iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png',
  iconSize:[25,41],iconAnchor:[12,41]
});

var iconMorado = L.icon({
  iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-violet.png',
  iconSize:[25,41],iconAnchor:[12,41]
});

// ======================= DATOS =======================
var data = [{"PEDIDO": "23476375", "OBSERVACION": "PROGRAMADO", "TIPO_VISITA": "C09", "MUNICIPIO": "EL RETIRO", "COORDENADAY": "6.03564117", "COORDENADAX": "-75.481944", "DIRECCION": "RURAL_190607200367820086_P VILLAS DEL CAMPO LT 86", "CLIENTE": "CARLOS ANDRES PEREZ OSOSRIO", "CELULAR": ""}, {"PEDIDO": "23511868", "OBSERVACION": "ANULADO", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.17863769", "COORDENADAX": "-75.450305", "DIRECCION": "RURAL_190616200462700148_CS 148 FORESTA", "CLIENTE": "HIDALGO VELEZ SIERRA", "CELULAR": ""}, {"PEDIDO": "23518340", "OBSERVACION": "CERRADO EN FENIX", "TIPO_VISITA": "C09", "MUNICIPIO": "ENVIGADO", "COORDENADAY": "6.18888", "COORDENADAX": "-75.50634386", "DIRECCION": "RURAL_125004571200000000_125004571200000000", "CLIENTE": "JORGE MARIO MORALES VALLEJO", "CELULAR": ""}, {"PEDIDO": "23554217", "OBSERVACION": "VISITADO", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.186681", "COORDENADAX": "-75.449193", "DIRECCION": "RURAL_190616200462700105_CS 105 FORESTA", "CLIENTE": "LUZ DARY TRUJILLO", "CELULAR": "3217983650"}, {"PEDIDO": "23566600", "OBSERVACION": "414", "TIPO_VISITA": "C09", "MUNICIPIO": "LA CEJA", "COORDENADAY": "6.05011477", "COORDENADAX": "-75.40514984", "DIRECCION": "RURAL_190376200092360000_VDA GUAMITO", "CLIENTE": "DELI FLOR AM\u00c9RICA S.A.S", "CELULAR": ""}, {"PEDIDO": "23569366", "OBSERVACION": "CAMBIARON FECHA", "TIPO_VISITA": "C09", "MUNICIPIO": "GUARNE", "COORDENADAY": "6.253062", "COORDENADAX": "-75.41269", "DIRECCION": "RURAL_190319206129080000_PARC PINERA LT 80", "CLIENTE": "LUZ MARCELA BORDA GOMEZ", "CELULAR": "3245408848"}, {"PEDIDO": "23572453", "OBSERVACION": "PENDIENTE POR PROGRAMAR", "TIPO_VISITA": "C09", "MUNICIPIO": "EL CARMEN DE VIBORAL", "COORDENADAY": "6.092885", "COORDENADAX": "-75.375113", "DIRECCION": "RURAL_190617200774265000_PARC LA SELVA- LT 124", "CLIENTE": "CATALINA AGUIRRE VALENCIA", "CELULAR": "3016941119"}, {"PEDIDO": "23572660", "OBSERVACION": "OBSERVADO", "TIPO_VISITA": "C09", "MUNICIPIO": "ENVIGADO", "COORDENADAY": "6.161099", "COORDENADAX": "-75.519571", "DIRECCION": "RURAL_125004448500000042_CR 6A N23 A SUR-85 INT 42", "CLIENTE": "INVERSIONES GYL SAS", "CELULAR": "3217983650"}, {"PEDIDO": "23573978", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "LA CEJA", "COORDENADAY": "6.05066674", "COORDENADAX": "-75.408785", "DIRECCION": "RURAL_190376200092650127_PARCELACION MONTECAPIRO L", "CLIENTE": "IMPORTACIONES KMG SAS", "CELULAR": "3146940296"}, {"PEDIDO": "23574686", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.132404", "COORDENADAX": "-75.38182314", "DIRECCION": "CL 25 A CR 55 E -66", "CLIENTE": "GLORIA ELENA ECHEVERRI ECHEVERRI", "CELULAR": "3127573723"}, {"PEDIDO": "23578363", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "SAN VICENTE", "COORDENADAY": "6.245396", "COORDENADAX": "-75.363983", "DIRECCION": "RURAL_190674200691120000_VDA PARTIDAS DE CHAPARRAL", "CLIENTE": "JUAN DAVID RENDON BERNAL", "CELULAR": "3195112530"}, {"PEDIDO": "23579526", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "EL CARMEN DE VIBORAL", "COORDENADAY": "5.96549013", "COORDENADAX": "-75.30807093", "DIRECCION": "RURAL_190400200630500000_MAZORCAL", "CLIENTE": "JUAN DE LA CRUZ URIBE ECHEVERRI", "CELULAR": "3217983650"}, {"PEDIDO": "23580975", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "LA CEJA", "COORDENADAY": "5.96640739", "COORDENADAX": "-75.43749451", "DIRECCION": "RURAL_190377200701300000_VDA FATIMA", "CLIENTE": "JUAN CAMILO VELEZ CORREA", "CELULAR": "3178872838"}, {"PEDIDO": "23586969", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "LA CEJA", "COORDENADAY": "6.03251716", "COORDENADAX": "-75.42292613", "DIRECCION": "RURAL_190375100082900000_CL 24 A CR 13 -28", "CLIENTE": "JORGE LEON TORO VALLEJO", "CELULAR": "3146940296"}, {"PEDIDO": "23588480", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.15366717", "COORDENADAX": "-75.38604769", "DIRECCION": "RURAL_190614100072565000_TANQ ALMAC EPRIO VD ABREO", "CLIENTE": "JHON DANILO MONSALVE RIVILLAS", "CELULAR": "3127573723"}, {"PEDIDO": "23590830", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.186825", "COORDENADAX": "-75.449755", "DIRECCION": "RURAL_190616200462700115_CS 115 FORESTA", "CLIENTE": "DANIEL HINESTROZA", "CELULAR": "3217983650"}, {"PEDIDO": "23593271", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "TITIRIB\u00cd", "COORDENADAY": "6.0056916", "COORDENADAX": "-75.75609542", "DIRECCION": "RURAL_190809200592550071_PARC LA SIRIA LT 71", "CLIENTE": "FEDERICO AGUDELO CANO", "CELULAR": "3192578480"}, {"PEDIDO": "23599317", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "MEDELL\u00cdN", "COORDENADAY": "6.2431566", "COORDENADAX": "-75.56478438", "DIRECCION": "CR 43 CL 44 -44", "CLIENTE": "ANA PATRICIA CASTRO CUARTAS", "CELULAR": ""}, {"PEDIDO": "23599397", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "SAN JER\u00d3NIMO", "COORDENADAY": "6.4188081", "COORDENADAX": "-75.7289863", "DIRECCION": "RURAL_190656200401826000_VDA EL BERRIAL LA", "CLIENTE": "JOHN JAIRO MU\u00d1OZ GUTIERREZ", "CELULAR": "3146212743"}, {"PEDIDO": "23602209", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "ENVIGADO", "COORDENADAY": "6.164322", "COORDENADAX": "-75.500952", "DIRECCION": "RURAL_125004764000000007_125004764000000007", "CLIENTE": "BEATRIZ ELENA CARMONA ARISTIZABAL", "CELULAR": ""}, {"PEDIDO": "23611330", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "EL PE\u00d1OL", "COORDENADAY": "6.20578081", "COORDENADAX": "-75.22267573", "DIRECCION": "RURAL_181051910000000000_RUR EL PE OL", "CLIENTE": "OTOINIEL DE JESUS MARIN GARCIA", "CELULAR": ""}, {"PEDIDO": "23620005", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "EL CARMEN DE VIBORAL", "COORDENADAY": "6.077031", "COORDENADAX": "-75.372912", "DIRECCION": "RURAL_190617200770090175_P. LA CAMPINA LT 53", "CLIENTE": "FRANCISCO JAVIER ESCOBAR ESCOBAR", "CELULAR": ""}, {"PEDIDO": "23488801", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "SANTAFE DE ANTIOQUIA", "COORDENADAY": "6.510723", "COORDENADAX": "-75.829383", "DIRECCION": "RURAL_190042200841100065_190042200841100065", "CLIENTE": "JUAN DAVID ESTRADA", "CELULAR": ""}, {"PEDIDO": "23496462", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "EL CARMEN DE VIBORAL", "COORDENADAY": "6.05647766", "COORDENADAX": "-75.35753763", "DIRECCION": "RURAL_190149200720950000_VEREDA EL CERRO", "CLIENTE": "MIGUEL ALBERTO MORENO QUIJANO", "CELULAR": ""}, {"PEDIDO": "23521622", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "EL PE\u00d1OL", "COORDENADAY": "6.18951835", "COORDENADAX": "-75.21235638", "DIRECCION": "RURAL_181057512500000000_RUR EL PE OL", "CLIENTE": "ANA MARIA ARISTIZABAL VILLEGAS", "CELULAR": ""}, {"PEDIDO": "23534935", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "MEDELL\u00cdN", "COORDENADAY": "6.22008631", "COORDENADAX": "-75.60398", "DIRECCION": "CR 81 B CL 7 A -49 (INTERIOR 129 )", "CLIENTE": "JULIO CESAR BEDOYA SIERRA", "CELULAR": "3112380761"}, {"PEDIDO": "23540409", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.12780267", "COORDENADAX": "-75.4551325", "DIRECCION": "RURAL_190617200542385000_TABLACITO", "CLIENTE": "GLORIA CECILIA CARDENAS DE LOPEZ", "CELULAR": "3217361666"}, {"PEDIDO": "23558018", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "ENVIGADO", "COORDENADAY": "6.176715", "COORDENADAX": "-75.569113", "DIRECCION": "CR 27 C CL 23 SUR -51 (INTERIOR 172 )", "CLIENTE": "ADRIANA PATRICIA RAMOS ACOSTA", "CELULAR": "3217565592"}, {"PEDIDO": "23579570", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "ENVIGADO", "COORDENADAY": "6.14999338", "COORDENADAX": "-75.54330191", "DIRECCION": "RURAL_125000407810000033_LAS PALMAS ENVIGADO", "CLIENTE": "JORGE ALONSO BOTERO MESA", "CELULAR": "3106455702"}, {"PEDIDO": "23589080", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "MEDELL\u00cdN", "COORDENADAY": "6.20298", "COORDENADAX": "-75.559175", "DIRECCION": "CR 29 CL 5 -61 (INTERIOR 1 )", "CLIENTE": "CONJUNTO RESIDENCIAL BALC\u00d3N DE LOS BUCAR", "CELULAR": ""}, {"PEDIDO": "23595574", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.11888783", "COORDENADAX": "-75.4515415", "DIRECCION": "RURAL_190617200543825000_VEREDA TABLACITO", "CLIENTE": "CIA16 SAS", "CELULAR": "3178243112"}, {"PEDIDO": "23601234", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.126662", "COORDENADAX": "-75.449229", "DIRECCION": "RURAL_190617200542100000_VEREDA TABLACITO", "CLIENTE": "FLORES DE ALTAGRACIA SAS", "CELULAR": ""}, {"PEDIDO": "23602812", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.187579", "COORDENADAX": "-75.451268", "DIRECCION": "RURAL_190616200462700130_CS 130 FORESTA", "CLIENTE": "CAMILO MEJIA", "CELULAR": ""}, {"PEDIDO": "23604856", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "EL RETIRO", "COORDENADAY": "6.02562333", "COORDENADAX": "-75.48873", "DIRECCION": "RURAL_190607200478387000_PARC MONTE SERENO CS 387", "CLIENTE": "GUSTAVO ADOLFO BOTERO", "CELULAR": ""}, {"PEDIDO": "23616526", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "ITAGU\u00cd", "COORDENADAY": "6.19206667", "COORDENADAX": "-75.59479966", "DIRECCION": "CL 86 A CR 52 D -54", "CLIENTE": "HERRAJES GAHER SAS", "CELULAR": ""}, {"PEDIDO": "23616668", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.187495", "COORDENADAX": "-75.451167", "DIRECCION": "RURAL_190616200462700131_CS 131 FORESTA", "CLIENTE": "LUIS FELIPE URREA", "CELULAR": ""}, {"PEDIDO": "23617432", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.14916", "COORDENADAX": "-75.407274", "DIRECCION": "RURAL_190616100411660146_PARC ALMANZA LT 46", "CLIENTE": "CARLOS HINCAPIE PALACIO", "CELULAR": ""}, {"PEDIDO": "23618521", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "LA CEJA", "COORDENADAY": "6.051409", "COORDENADAX": "-75.433773", "DIRECCION": "RURAL_190376200340210104_PC PINARES", "CLIENTE": "PABLO ANDRES VAHOS PINEDA", "CELULAR": ""}, {"PEDIDO": "23619234", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "LA UNI\u00d3N", "COORDENADAY": "6.01965788", "COORDENADAX": "-75.35543045", "DIRECCION": "RURAL_190400200430500000_VEREDA LA ALMERIA", "CLIENTE": "CECILIA STELLA BOTERO CAMPUZANO", "CELULAR": ""}, {"PEDIDO": "23627676", "OBSERVACION": "", "TIPO_VISITA": "C09", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.186867", "COORDENADAX": "-75.449745", "DIRECCION": "RURAL_190616200462700154_CS 154 FORESTA", "CLIENTE": "JUAN SEBASTIAN RAMIREZ", "CELULAR": ""}, {"PEDIDO": "23614841", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "PE\u00d1OL", "COORDENADAY": "6.17863769", "COORDENADAX": "-75.450305", "DIRECCION": "RURAL_181030253503000000_VDA LA CHAPA", "CLIENTE": "DIANA LUCIA MORENO", "CELULAR": "3023754780"}, {"PEDIDO": "23618492", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "MEDELLIN", "COORDENADAY": "6.20075311", "COORDENADAX": "-75.55617868", "DIRECCION": "CR 10 CL 19 SUR -5 (INTERIOR 155 )", "CLIENTE": "FUNDACION RESERVA NATURAL EL GARCERO", "CELULAR": "3153172373"}, {"PEDIDO": "23607379", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "RETIRO", "COORDENADAY": "6.25356381", "COORDENADAX": "-75.42378167", "DIRECCION": "RURAL_190607200513175000_VEREDA DON DIEGO LT 3", "CLIENTE": "JOSE MARIA MARTINEZ ARIAS", "CELULAR": "3152981271"}, {"PEDIDO": "23618443", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "RETIRO", "COORDENADAY": "6.186681", "COORDENADAX": "-75.449193", "DIRECCION": "RURAL_190607200551142000_PARC LOS CHAGUALOS LT 8", "CLIENTE": "JUAN LUIS URIBE URIBE", "CELULAR": "3186905214"}, {"PEDIDO": "23612603", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "LA UNI\u00d3N", "COORDENADAY": "6.05011477", "COORDENADAX": "-75.40514984", "DIRECCION": "RURAL_190400200394615000_VDA SALA DE ORDEN", "CLIENTE": "JULIO CESAR LOPEZ TABARES", "CELULAR": "3014026291"}, {"PEDIDO": "23618470", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.092885", "COORDENADAX": "-75.375113", "DIRECCION": "RURAL_190617200650300000_STA MARIA VDA CHIPRE", "CLIENTE": "LOS TRES GONZALEZ RESTREPO SAS LOS TRES GONZALEZ RESTREPO SAS", "CELULAR": "3137697955"}, {"PEDIDO": "23614816", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.161099", "COORDENADAX": "-75.519571", "DIRECCION": "RURAL_190616200462700131_CS 131 FORESTA", "CLIENTE": "LUIS FELIPE URREA", "CELULAR": "3217983650"}, {"PEDIDO": "23613870", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "SAN JER\u00d3NIMO", "COORDENADAY": "6.05066674", "COORDENADAX": "-75.408785", "DIRECCION": "RURAL_190656200638508027_190656200638508027", "CLIENTE": "LUIS HENRY GAVIRIA MU\u00d1OZ", "CELULAR": "3215621332"}, {"PEDIDO": "23605334", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "GUATAP\u00c9", "COORDENADAY": "6.132404", "COORDENADAX": "-75.38182314", "DIRECCION": "RURAL_176015230000000000_RUR SAN RAFAEL", "CLIENTE": "MATILDE DEL SOCORRO ARANGO GONZALEZ", "CELULAR": "3023754780"}, {"PEDIDO": "23618480", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "GUATAP\u00c9", "COORDENADAY": "6.245396", "COORDENADAX": "-75.363983", "DIRECCION": "RURAL_176014728000000000_176014728000000000", "CLIENTE": "SERGIO DE JESUS GIRALDO CEBALLOS", "CELULAR": "3164937806"}, {"PEDIDO": "23621185", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "MEDELLIN", "COORDENADAY": "5.96640739", "COORDENADAX": "-75.43749451", "DIRECCION": "RURAL_147017703906000000_147017703906000000", "CLIENTE": "VANESSA ALEXANDRA RENDON CORTES", "CELULAR": "3227469490"}, {"PEDIDO": "23616489", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "RETIRO", "COORDENADAY": "6.03251716", "COORDENADAX": "-75.42292613", "DIRECCION": "RURAL_140004950000000034_CR 3A CL 29SUR -98 CS 34", "CLIENTE": "EDWIN ALBERTO LOPEZ RESTREPO", "CELULAR": "3178221364"}, {"PEDIDO": "23617324", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "EL CARMEN DE VIBORAL", "COORDENADAY": "6.15366717", "COORDENADAX": "-75.38604769", "DIRECCION": "RURAL_190617200770090175_P. LA CAMPINA LT 53", "CLIENTE": "FRANCISCO JAVIER ESCOBAR ESCOBAR", "CELULAR": "3127573723"}, {"PEDIDO": "23618521", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.161099", "COORDENADAX": "-75.519571", "DIRECCION": "RURAL_190617200536400000_190617200536400000", "CLIENTE": "HUMBERTO DE JESUS DE LA ROCHE MARTINEZ", "CELULAR": "3183584396"}, {"PEDIDO": "23617432", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "MEDELLIN", "COORDENADAY": "6.05066674", "COORDENADAX": "-75.408785", "DIRECCION": "RURAL_114007603200000000_VEREDA_EL JARDIN", "CLIENTE": "MARIA CECILIA CASTA\u00d1O CARDONA", "CELULAR": "3128344833"}, {"PEDIDO": "23619900", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "LA CEJA", "COORDENADAY": "6.132404", "COORDENADAX": "-75.38182314", "DIRECCION": "RURAL_190376200340210104_PC PINARES", "CLIENTE": "PABLO ANDRES VAHOS PINEDA", "CELULAR": "3113659202"}, {"PEDIDO": "23619238", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.245396", "COORDENADAX": "-75.363983", "DIRECCION": "RURAL_190616100411660146_PARC ALMANZA LT 46", "CLIENTE": "CARLOS ANDRES HINCAPIE PALACIO", "CELULAR": "3104539657"}, {"PEDIDO": "23619250", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "RETIRO", "COORDENADAY": "5.96640739", "COORDENADAX": "-75.43749451", "DIRECCION": "RURAL_190607200550074000_PARC EL SALADITO L 9B", "CLIENTE": "DAVID ALEJANDRO BOTERO LOPEZ", "CELULAR": "3005451704"}, {"PEDIDO": "23622112", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "ENVIGADO", "COORDENADAY": "6.03251716", "COORDENADAX": "-75.42292613", "DIRECCION": "CL 36 SUR CR 27 C -5 (INTERIOR 35 )", "CLIENTE": "JAIME ALBERTO PARRA FRANCO", "CELULAR": "3135920787"}, {"PEDIDO": "23620644", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.15366717", "COORDENADAX": "-75.38604769", "DIRECCION": "RURAL_190616200462700158_CS 158 FORESTA", "CLIENTE": "MARISOL SIERRA CARDONA", "CELULAR": "3217983650"}, {"PEDIDO": "23619240", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "RIONEGRO", "COORDENADAY": "6.161099", "COORDENADAX": "-75.519571", "DIRECCION": "RURAL_190617200574240000_PARCELACION ANDALUCIA", "CLIENTE": "SERGIO DE JESUS CASTA\u00d1O GOMEZ", "CELULAR": "3196935329"}, {"PEDIDO": "23618590", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "RETIRO", "COORDENADAY": "6.05066674", "COORDENADAX": "-75.408785", "DIRECCION": "RURAL_190607200478631001_PARC MONTE SERENO CS 631A", "CLIENTE": "CAROLINA MESA BARRENECHE", "CELULAR": "3206387311"}, {"PEDIDO": "23605437", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "LA UNI\u00d3N", "COORDENADAY": "6.132404", "COORDENADAX": "-75.38182314", "DIRECCION": "RURAL_190400200430500000_VEREDA LA ALMERIA", "CLIENTE": "CECILIA STELLA BOTERO CAMPUZANO", "CELULAR": "3104089418"}, {"PEDIDO": "23605438", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "LA UNI\u00d3N", "COORDENADAY": "6.245396", "COORDENADAX": "-75.363983", "DIRECCION": "RURAL_190400200390100000_VEREDA LA MADERA", "CLIENTE": "DIANA CAROLINA ARANGO TOBON", "CELULAR": "3147911660"}, {"PEDIDO": "23605439", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "ENVIGADO", "COORDENADAY": "5.96640739", "COORDENADAX": "-75.43749451", "DIRECCION": "CL 36 SUR CR 27 C -5 (INTERIOR 36 )", "CLIENTE": "MARCO TULIO SALDARRIAGA SANTAELLA", "CELULAR": "3135920787"}, {"PEDIDO": "23605440", "OBSERVACION": "", "TIPO_VISITA": "C07", "MUNICIPIO": "ENVIGADO", "COORDENADAY": "6.03251716", "COORDENADAX": "-75.42292613", "DIRECCION": "CL 31 SUR CR 45 A -3 (INTERIOR 140 )", "CLIENTE": "CONJUNTO RESIDENCIAL LUNA VERDE PORTERIA", "CELULAR": "3137335541"}];
var markers = [];
var layer = L.layerGroup().addTo(map);

// ======================= AGRUPAR POR COORD =======================
var grupos = {};
data.forEach(d => {
  if(d.COORDENADAY && d.COORDENADAX){
    let k = d.COORDENADAY + ',' + d.COORDENADAX;
    if(!grupos[k]) grupos[k] = [];
    grupos[k].push(d);
  }
});

function cargarFiltros(){
  let obs=new Set(), tipo=new Set();
  data.forEach(d=>{obs.add(d.OBSERVACION); tipo.add(d.TIPO_VISITA);});
  obs.forEach(o=>fObs.innerHTML+=`<option value="${o}">${o}</option>`);
  tipo.forEach(t=>fTipo.innerHTML+=`<option value="${t}">${t}</option>`);
}

function pintar(arr){
  layer.clearLayers(); markers=[];
  let bounds=[];

  Object.keys(grupos).forEach(key => {
    let pedidos = grupos[key].filter(d => arr.includes(d));
    if(pedidos.length === 0) return;

    let d = pedidos[0];
    let icono = pedidos.length > 1 ? iconMorado : (d.TIPO_VISITA=="C09" ? iconNaranja : iconAzul);

    let popupHtml = "";

    if(pedidos.length > 1){
      popupHtml = `<b>üìç ${pedidos.length} pedidos en esta ubicaci√≥n</b><br><br>`;
      pedidos.forEach(p => {
        popupHtml += `
          ‚Ä¢ <b>Pedido:</b> ${p.PEDIDO}<br>
            <b>Cliente:</b> ${p.CLIENTE}<br>
            <b>Municipio:</b> ${p.MUNICIPIO}<br>
            <b>Tipo visita:</b> ${p.TIPO_VISITA}<br>
            <b>Direcci√≥n:</b> ${p.DIRECCION}<br><br>
        `;
      });
    } else {
      popupHtml = `
        <b>Pedido:</b> ${d.PEDIDO}<br>
        <b>Cliente:</b> ${d.CLIENTE}<br>
        <b>Municipio:</b> ${d.MUNICIPIO}<br>
        <b>Tipo visita:</b> ${d.TIPO_VISITA}<br>
        <b>Direcci√≥n:</b> ${d.DIRECCION}<br>
        <b>Celular:</b> ${d.CELULAR}
      `;
    }

    let m = L.marker([d.COORDENADAY,d.COORDENADAX],{icon:icono})
      .bindPopup(popupHtml);

    m.datos = {
      pedido: d.PEDIDO,
      cliente: d.CLIENTE,
      municipio: d.MUNICIPIO,
      tipo_visita: d.TIPO_VISITA,
      direccion: d.DIRECCION,
      celular: d.CELULAR,
      urlMaps: `https://www.google.com/maps?q=${d.COORDENADAY},${d.COORDENADAX}`
    };

    layer.addLayer(m);
    markers.push(m);
    bounds.push([d.COORDENADAY,d.COORDENADAX]);
  });

  if(bounds.length === 1) {
    map.setView(bounds[0], 16);
  } else if(bounds.length > 1) {
    map.fitBounds(bounds, {padding:[40,40]});
  }
}

function aplicarFiltros(){
  pintar(data.filter(d =>
    (!fPedido.value || d.PEDIDO.includes(fPedido.value)) &&
    (!fObs.value || d.OBSERVACION==fObs.value) &&
    (!fTipo.value || d.TIPO_VISITA==fTipo.value)
  ));
}

function limpiarFiltros(){
  fPedido.value=""; fObs.value=""; fTipo.value="";
  pintar(data);
}

function copiarEnlace(){
  let pedido = fPedido.value;
  if(!pedido) return;

  let m = markers.find(x => x.datos && x.datos.pedido.includes(pedido));
  if(!m) return;

   navigator.clipboard.writeText(
    "Pedido: " + m.datos.pedido + "\n" +
    "Cliente: " + m.datos.cliente + "\n" +
    "Municipio: " + m.datos.municipio + "\n" +
    "Tipo visita: " + m.datos.tipo_visita + "\n" +
    "Direcci√≥n: " + m.datos.direccion + "\n" +
    "Celular: " + m.datos.celular + "\n\n" +
    "Ubicaci√≥n Google Maps:\n" + m.datos.urlMaps
  );

  toast.style.display="block";
  setTimeout(()=>toast.style.display="none",2500);
}

cargarFiltros();
pintar(data);
</script>

</body>
</html>
